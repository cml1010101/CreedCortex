cmake_minimum_required(VERSION 3.27)
project(CreedCortex VERSION 0.1.0 LANGUAGES CXX)
option(USE_CUDA "Whether to use CUDA for faster matrix mathematics." ON)
option(USE_SIMD "Whether to use SIMD for faster matrix mathematics. Ignored if CUDA is enabled." OFF)
option(BUILD_TESTS "Whether to build test applications" ON)
add_library(CreedCortex "src/CreedMatrix.cpp")
if (USE_CUDA)
    message("Using CUDA")
    enable_language(CUDA)
    target_compile_definitions(CreedCortex PRIVATE USE_CUDA)
    target_sources(CreedCortex PUBLIC "src/CreedCUDA.cu")
    set_property(TARGET CreedCortex PROPERTY CUDA_ARCHITECTURES native)
elseif(USE_SIMD)
    message("Using SIMD")
    target_compile_definitions(CreedCortex USE_SIMD)
endif()
if(BUILD_TESTS)
    message("Building tests")
    add_executable(BasicTest "test/BasicTest.cpp")
    add_test(NAME BasicTest COMMAND BasicTest)
    target_link_libraries(BasicTest PUBLIC CreedCortex)
    target_include_directories(BasicTest PUBLIC "include")
endif()
target_include_directories(CreedCortex PUBLIC "include")